# CommU⇆

コミュニケーションを支援するBluetooth対応PWAアプリケーション

## 概要

CommU⇆は、言葉を話すのが苦手な方や自分の気持ちを言語化しにくい方のためのコミュニケーション支援ツールです。質問者がテキストで質問を送信し、回答者が「はい」「いいえ」「わからない」「答えたくない」の4択またはテキストで回答できます。

## 主な機能

- **Bluetooth通信**: デバイス間でインターネットを介さない直接通信
- **PWA対応**: スマートフォンにインストール可能
- **役割選択**: 質問者・回答者・音響モードの3つのモード
- **ルーム機能**: 5桁の数字IDでルーム作成・参加
- **カスタマイズ機能**: 回答ボタンの文言変更
- **アニメーション**: 質問表示時のアニメーション効果
- **効果音**: 回答時の効果音・合成音声
- **履歴管理**: やりとり履歴の表示と保存
- **データエクスポート**: TXT/CSV形式またはメール送信

## 使用方法

### 1. 初回接続
1. 両方のデバイスでアプリを開く
2. 一方を「ホストになる」、もう一方を「相手とつながる」に設定
3. Bluetoothペアリングを完了

### 2. 役割選択
- **質問する人になる**: ルームを作成し、質問を送信
- **答える人になる**: ルームに参加し、4択またはテキストで回答
- **言葉で質問・音で回答**: 音響モードで効果音による回答

### 3. ルーム操作
- **ルーム作成**: 5桁の数字IDを設定（ランダム生成も可能）
- **ルーム参加**: 利用可能なルーム一覧から選択
- **満員制限**: 1ルームあたり質問者1名・回答者1名まで

### 4. コミュニケーション
- 質問者がテキストと表示アニメーションを選択して送信
- 回答者が4択ボタンまたはテキストで回答（効果音付き）
- フリーメッセージで自由な発言も可能
- やりとり履歴をリアルタイムで確認

## 技術仕様

- **フロントエンド**: HTML5, CSS3, JavaScript (ES6+)
- **通信**: Web Bluetooth API (Nordic UART Service)
- **音声**: Speech Synthesis API, Audio Context API
- **PWA**: Service Worker, Web App Manifest
- **対応ブラウザ**: Chrome 56+, Edge 79+（Bluetooth対応）

## 動作環境

- **必須**: HTTPS環境での実行
- **推奨**: Android Chrome, Windows 10 Chrome, Chrome OS
- **制限**: iOS Safariは部分サポート

## セットアップ

### 開発環境
```bash
# HTTPSサーバーの起動（開発用）
python -m http.server 8000 --bind 127.0.0.1
# または
npx http-server -p 8000 -a 127.0.0.1
```

### 本番環境
- GitHub Pagesまたは他のHTTPS対応ホスティングサービスを使用

## Bluetooth設定

本アプリは以下のBluetooth Low Energy仕様を使用:
- **Service UUID**: `6e400001-b5a3-f393-e0a9-e50e24dcca9e`
- **TX Characteristic**: `6e400002-b5a3-f393-e0a9-e50e24dcca9e`
- **RX Characteristic**: `6e400003-b5a3-f393-e0a9-e50e24dcca9e`

## ファイル構成

```
commu/
├── index.html          # メインHTML
├── app.js             # アプリケーションロジック
├── styles.css         # スタイルシート
├── manifest.json      # PWAマニフェスト
├── sw.js              # Service Worker
├── create-icons.html  # アイコン生成ツール
├── icon-192.png       # PWAアイコン (192x192)
├── icon-512.png       # PWAアイコン (512x512)
└── README.md          # このファイル
```

## 開発者向け情報

### メッセージ形式
```javascript
{
  type: 'question' | 'answer' | 'message' | 'room_created' | 'room_joined',
  data: {
    // メッセージ固有のデータ
  }
}
```

### 分割メッセージ対応
BLEの20バイト制限に対応するため、大きなメッセージは自動的に分割送信されます。

### エラーハンドリング
- 接続断での自動再接続（最大3回）
- 詳細なエラーメッセージ表示
- デモモードでのフォールバック

## ライセンス

MIT License

## 貢献

プルリクエストやイシューの報告を歓迎します。

## サポート

技術的な問題や改善提案がありましたら、GitHubのIssuesをご利用ください。